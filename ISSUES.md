# 開発タスク一覧

## Issue 0: Detail Drawer 機能の完全実装 ✅

**ステータス**: 完了（2025-11-23）

**概要**
ユーザービューのデバイスリストで行をクリックした際に表示される詳細ドロワー（Detail Drawer）の表示内容とレイアウトを完成させる。

**背景**
現在の Detail Drawer は、選択されたレコードの全データを単純な Key-Value ペアとして羅列しているだけであり、ユーザーにとって見やすい形式になっていない。業務に必要な情報を整理し、適切なグルーピングやレイアウトで表示する必要がある。

**実装内容**

### 1. スペックシート形式のレイアウト実装

- ヘッダー部分を横並びレイアウトに変更（SPEC SHEET、SHEET No.、Rev.、Page.）
- セクション別の情報表示:
  - CHIP APPEARANCE: チップ外観画像
  - CHIP SPECS: チップ仕様（サイズ、ダイシングライン、パッド寸法など）
  - Maximum Ratings: 最大定格
  - WAFER PROBING SPEC: ウェハープロービング仕様
  - NOTES: 注記情報

### 2. チップ外観画像表示機能

- `MT_maskset.appearance`フィールドに基づいて画像を表示
- バックエンドに静的ファイル配信エンドポイント追加（`/static/chip_appearances`）
- 画像が存在しない場合は"No Image"プレースホルダーを表示

### 3. NOTE 欄の改善

- 同じ `sheet_no`を持つすべてのデバイスタイプを昇順で表示
- 各デバイスタイプごとに個別データを表示:
  - TOP METAL: `MT_device.top_metal`
  - CHIP THICKNESS: `MT_device.wafer_thickness`
  - BACK METAL: `MT_device.back_metal`

### 4. UI/UX の改善

- テーブルの外形線を控えめに変更（黒 → グレー）
- 視認性を保ちながらも目立ちすぎないデザインに調整

### 5. バックエンド API 改善

- 新規エンドポイント: `GET /api/devices/{device_type}/details`
- 複数のマスターテーブルを結合してデバイス詳細情報を取得
- 関連するすべてのデバイスタイプのデータを含む

### 6. スキーマ修正

- `MT_device.wafer_thickness`: `BigInteger` → `String`（"140 +/-10 um"形式に対応）
- `MT_maskset.pdpw`: `Integer` → `String`（"23,318"形式に対応）

**完了したタスク**

- [x] 表示すべき項目とグルーピングの定義
- [x] Detail Drawer コンポーネントのレイアウト改修
- [x] 不要な内部 ID などの非表示化
- [x] スタイリングの調整（見やすさの向上）
- [x] マスターデータからの情報取得と表示
- [x] チップ外観画像表示機能
- [x] NOTE 欄の改善（関連デバイスタイプ表示）

**関連 PR**

- #[PR 番号] - Detail Drawer 機能の完全実装

## Issue 1: 一般ユーザー向けデータ閲覧画面（ユーザービュー）の新規実装

**概要**
現在の管理者向けマスター管理画面とは別に、一般ユーザーが日常業務でデータを参照するための専用画面を実装する。

**背景**
現在は全テーブルを管理する「マスター画面」のみが存在するが、一般ユーザーには情報過多であり、かつ誤操作のリスクもあるため、必要な情報のみを表示する閲覧専用画面が必要である。

**詳細要件**

- 管理者画面（Master View）とユーザー画面（User View）の分離
- ユーザー画面は「閲覧」を主目的とし、編集機能は持たせない（または制限する）
- ユーザーにとって見やすいレイアウト（ダッシュボード形式や、特定の業務フローに沿った表示など）

**タスク**

- [x] ユーザー画面用のルート作成（例: `/user`）
- [x] ユーザー向けトップページのデザイン・実装
- [x] 必要なデータのみを取得・表示する API またはフィルタリング処理の実装
- [x] ナビゲーションへのユーザー画面リンク追加

**結果**

- `/user` ルートを作成し、ユーザー専用のダッシュボード画面を実装しました。
- **デバイスリスト**: `MT_device` と `MT_spec_sheet` を結合した業務に直結するデバイス仕様一覧をデフォルト表示。
- **マスターテーブル閲覧**: 必要に応じて全マスターテーブルにアクセス可能なビューも用意。
- トップナビゲーションバーで Master View と User View を切り替え可能。
- ソート機能を改善し、空白値を常に最後に配置することで、データのあるレコードを優先的に表示。

## Issue 2: マスターデータのデータ型定義および主キー設定の適正化

**概要**
データベース上の各カラムに対し、適切なデータ型（数値、日付など）と主キー（Primary Key）を正しく設定・管理できるようにする。

**背景**
現状のインポート処理では、Excel からのデータ取り込み時に多くのカラムが「テキスト型（TEXT）」として定義されている可能性が高い。これにより、数値のソートが正しく行われない、日付計算ができない、データの整合性が保てない等の問題が発生する恐れがある。また、主キーが明確でないとレコードの特定やリレーションの構築に支障をきたす。

**詳細要件**

- **データ型の適正化**: 数値は数値型、日付は日付型として DB に格納する。
- **主キーの設定**: 各テーブルに対し、ユニークな ID または特定のカラムを主キーとして設定するルールを確立する。
- **スキーマ管理**: Excel のデータから推論するだけでなく、必要に応じて型定義を指定できる仕組みを検討する。

**タスク**

- [x] 現状の DB スキーマ（各カラムの型）の調査・確認
- [x] インポートスクリプト（`scripts/import_data.py` 等）における型推論ロジックの改善
- [x] 主キー（Primary Key）の自動付与または指定ルールの実装
- [x] 数値・日付データのソートや検索が正しく動作することの検証

**結果**

- `backend/schema.py` を作成し、SQLAlchemy を用いて全テーブルのスキーマ（型、主キー）を厳密に定義しました。

- Excel データ内の不正な数値（"Dummy", "A" 等）は `NaN` (NULL) として取り込むようにし、API エラー（500 Error）およびフロントエンドの Network Error を解消しました。
- `MT_device` (type), `MT_spec_sheet` (sheet_no) を主キーとして設定し、他は `id` (自動採番) を主キーとしました。

## Issue 4: 認証・認可（ログイン機能）の実装

**概要**
システムへのアクセス制御を行い、管理者と一般ユーザーで利用できる機能を制限する。

**背景**
Issue 1 でユーザー画面と管理者画面を分ける方針となったが、URL を知っていれば誰でも管理者画面にアクセスできてしまう状態はセキュリティ上好ましくない。また、誰が操作しているかを特定するためにも認証機能が必要である。

**詳細要件**

- **ログイン画面**: ユーザー名/パスワード等による認証。
- **権限管理 (Role-Based Access Control)**:
  - **Admin**: データインポート、全テーブル閲覧、システム設定が可能。
  - **User**: 許可されたビューの閲覧のみ可能。
- **セッション管理**: ログイン状態の維持とログアウト機能。

**タスク**

- [ ] ユーザー管理テーブルの作成
- [ ] JWT またはセッションベースの認証 API の実装
- [ ] フロントエンドへのログイン画面追加と保護ルート（Protected Routes）の実装

## Issue 5: データのバリデーションと整合性チェックの強化 ✅

**ステータス**: 完了（2025-11-25）

**概要**
データの品質を保つため、インポート時およびデータ操作時に厳密なチェックを行う。

**背景**
Excel データの入力ミスやフォーマット違反を防ぐため、システム側でルールに基づいたバリデーションを行う必要がある。

**詳細要件**

- **必須チェック**: 必須項目の欠損検知。
- **型チェック**: 数値項目に文字が入っていないか等。
- **参照整合性 (Foreign Key)**: マスタ間のリレーションが正しいか（例: 存在しない部署コードが社員マスタに含まれていないか）のチェック。
- **エラーレポート**: インポート時に不備があった場合、具体的な行番号とエラー内容をユーザーに通知する。

**タスク**

- [ ] バリデーションルールの定義方法の検討（設定ファイルやスキーマ定義）
- [ ] インポート処理へのバリデーションロジック追加
- [x] バリデーションルールの定義方法の検討（設定ファイルやスキーマ定義）
- [x] インポート処理へのバリデーションロジック追加
- [x] エラーログ出力・表示機能の実装

**結果**

- Pydantic モデルを使用した厳密な型チェックと、テーブル間の参照整合性（Foreign Key）チェックを実装しました。
- 当初は不整合データを含む行をスキップする仕様でしたが、既存データに多数の不整合が見つかったため、**緩和策**として「警告（Warning）ログを出力しつつ、データはインポートする」仕様に変更しました。
- これにより、データの欠落を防ぎつつ、不整合箇所を特定できるようになりました。

## Issue 6: データの変更履歴管理（監査ログ） ✅

**ステータス**: 完了（2025-11-24）

**概要**
「いつ」「誰が」「何をしたか」を記録し、追跡可能にする。

**背景**
マスタデータがいつ更新されたのか、意図しない変更が行われていないかを確認するために、操作ログが必要となる。

**実装内容**

### 1. データベーススキーマ

- **AuditLog テーブルの追加**:
  - `id`: 自動採番の主キー
  - `timestamp`: 操作実行日時（ISO 8601 形式）
  - `user`: 操作実行ユーザー
  - `action`: アクション種別（例: "IMPORT"）
  - `target`: 操作対象（例: "ALL"）
  - `details`: 詳細情報（JSON または テキスト）

### 2. インポート処理の改善

- **AuditLog テーブルの保護**: データ再インポート時に `AuditLog` テーブルを削除しないように変更
- **自動ログ記録**: インポート完了時に以下の情報を自動記録:
  - タイムスタンプ
  - ユーザー: "System"
  - アクション: "IMPORT"
  - 対象: "ALL"
  - 詳細: インポートされた行数とテーブル名

### 3. API エンドポイント

- **`GET /api/audit-logs`**: 監査ログの取得
  - ページネーション対応（デフォルト: 50 件/ページ）
  - ソート機能（デフォルト: timestamp 降順）
  - 既存の DataTable コンポーネントと互換性のあるレスポンス形式

### 4. フロントエンド UI

- **Audit Logs ページ**: `/audit-logs` ルートで監査ログを表示
  - Master View のサイドバーに「Audit Logs」メニュー項目を追加
  - `ClipboardList` アイコンを使用
  - 既存の `DataTable` コンポーネントを再利用
  - ページネーション、ソート、検索機能が利用可能
  - 「Back to Master View」ボタンで元の画面に戻る

**完了したタスク**

- [x] ログ保存用テーブルの設計
- [x] インポート処理および主要アクションへのログ出力処理の追加
- [x] ログ閲覧画面の実装
- [x] サイドバーへのメニュー項目追加
- [x] デザインの統一（User Dashboard と同じスタイル）

**使用方法**

1. ブラウザで `http://localhost:5173/master` にアクセス
2. 左サイドバーの「Audit Logs」をクリック
3. 監査ログテーブルが表示されます

**表示される情報**

- **timestamp**: 操作実行日時
- **user**: 操作実行ユーザー
- **action**: アクション種別
- **target**: 操作対象
- **details**: 詳細情報

**今後の拡張可能性**

- ユーザー認証との統合（実際のユーザー名を記録）
- データ編集ログ（レコードごとの変更履歴）
- エクスポートログ（データエクスポート操作の記録）
- ログフィルタリング（アクション種別やユーザーでフィルタリング）
- ログ保持期間設定（古いログの自動削除）

## Issue 7: 検索・フィルタリング機能の高度化とエクスポート

**概要**
蓄積されたデータをより活用しやすくするための機能強化。

**背景**
単純なキーワード検索だけでなく、複合条件での絞り込みや、結果の二次利用（Excel/CSV ダウンロード）が業務上求められることが多い。

**詳細要件**

- **詳細検索**: カラムごとのフィルタリング（範囲指定、完全一致/部分一致など）。
- **エクスポート**: 表示中のデータ（検索結果含む）を CSV または Excel 形式でダウンロードする機能。

**タスク**

- [x] バックエンドのクエリパラメータ処理の拡張（フィルタリング機能強化）
- [x] フロントエンドへの詳細検索 UI 追加
- [x] CSV/Excel エクスポート API の実装

**結果**

- **フィルタリング機能**: バックエンド・フロントエンド双方で、カラムごとの詳細なフィルタリング（部分一致、数値範囲指定）を実装しました。
- **エクスポート機能**: フィルタリング結果を反映した状態で、データを Excel ファイルとしてダウンロードできる機能を実装しました。
- **UI 改善**: フィルターボタンとエクスポートボタンをヘッダーに追加し、直感的に操作できるようにしました。

## Issue 8: 大量データ対応（ページネーション・パフォーマンス最適化） ✅

**ステータス**: 完了（2025-11-24）

**概要**
データ量が増加しても快適に動作するようにパフォーマンスを最適化する。

**背景**
現在は全件取得を行っている可能性があるが、レコード数が数万件を超えるとブラウザの動作が重くなるため、サーバーサイドページネーション等が必要になる。

**実装内容**

### 1. バックエンド API のページネーション対応

- **`GET /api/tables/{table_name}` の改修**:

  - クエリパラメータ `page`, `limit`, `search`, `sort_by`, `descending` に対応
  - SQLAlchemy を使用した効率的なクエリ実行（`LIMIT`, `OFFSET`）
  - レスポンス形式: `{ "data": [...], "total": ..., "page": ..., "limit": ..., "total_pages": ... }`
  - `pandas` による全件メモリ読み込みを廃止

- **`GET /api/user/devices` の改修**:

  - Master Tables と同様のページネーション機能を実装
  - カラム名とデータベースカラムのマッピングによる正確なソート機能

### 2. フロントエンドのデータテーブルコンポーネントの改修

- **`DataTable.jsx` の改修**:
  - サーバーサイドページネーション対応（デフォルト: 100 件/ページ）
  - ページ送りボタン（Previous/Next）とページ情報表示の追加
  - 検索入力のデバウンス処理（500ms）による API リクエスト最適化
  - ソート機能のサーバーサイド連携
  - `customData` 使用時はクライアントサイドでの処理を維持（ハイブリッド仕様）

### 3. パフォーマンス最適化

- 全件取得を廃止し、必要なデータのみを取得
- 初期ロード時間の短縮
- ブラウザのメモリ使用量削減

**完了したタスク**

- [x] バックエンド API のページネーション対応
- [x] フロントエンドのデータテーブルコンポーネントの改修（ページ送り機能追加）
- [x] 検索・ソート機能のサーバーサイド連携
- [x] User Devices API のページネーション対応
- [x] 動作検証とパフォーマンス確認

## Issue 9: Master Tables のアイコンを分かりやすいものに変更

**概要**
Master View および User View で表示されるマスターテーブルのアイコンを、より直感的で分かりやすいものに変更する。

**背景**
現在のアイコンは汎用的なものが使用されており、各マスターテーブルの役割や内容が一目で理解しにくい状態となっている。ユーザビリティを向上させるため、各テーブルの性質に合った適切なアイコンを選定・適用する必要がある。

**詳細要件**

- **アイコンの選定**: 各マスターテーブルの内容に即した分かりやすいアイコンを選定する。
  - MT_device: デバイス/チップを連想させるアイコン
  - MT_spec_sheet: 仕様書/ドキュメントを連想させるアイコン
  - MT_maskset: マスク/レイヤーを連想させるアイコン
  - その他のテーブルについても同様に適切なアイコンを選定
- **一貫性の確保**: アイコンのスタイル（サイズ、色、デザイン）を統一し、UI 全体の一貫性を保つ。
- **視認性の向上**: ダークモード/ライトモードの両方で見やすいアイコンを選定する。

**タスク**

- [x] 各マスターテーブルに適したアイコンの選定
- [x] フロントエンドコンポーネントへのアイコン適用
- [x] ダークモード/ライトモードでの視認性確認
- [x] UI の一貫性チェック

**結果**

- `Sidebar.jsx` において、Master Tables のアイコンを `Database` から `FileSpreadsheet` に変更しました。
- これにより、ユーザービューでの「Master Tables」が、個別のテーブルデータ（スプレッドシート形式）の集合であることをより直感的に表現しました。

## Issue 10: Detail Drawer の WAFER PROBING SPEC CONDITION 欄の表示改善 ✅

**ステータス**: 完了 (2025-11-24)

**概要**
Detail Drawer で表示される WAFER PROBING SPEC セクションの CONDITION 欄について、より詳細で分かりやすい表示形式に改善する。

**背景**
現在の実装では、`MT_elec_characteristic` テーブルの `cond` カラムのみを表示しているが、実際には複数のバイアス条件フィールド（`bias_vgs`, `bias_igs`, `bias_vds`, `bias_ids`, `bias_vss`, `bias_iss`, `condition`）が存在し、これらを組み合わせて表示することで、より正確で詳細な測定条件を提示できる。

**現状**

- `MT_elec_characteristic.cond` のみを CONDITION 欄に表示
- 他のバイアス条件フィールドが活用されていない

**修正案**

- 以下のフィールドを組み合わせて CONDITION 欄を構成する:
  - `bias_vgs` (例: "Vgs=Vds")
  - `bias_igs` (例: "Igs=250uA")
  - `bias_vds` (例: "Vds=5V")
  - `bias_ids` (例: "Ids=250uA")
  - `bias_vss` (例: "Vss=0V")
  - `bias_iss` (例: "Iss=1mA")
  - `condition` (その他の条件)
- 空白（NULL または空文字列）のフィールドは表示しない
- 複数の条件がある場合は、カンマ区切りまたは改行で表示（例: "Ids=250uA, Vgs=Vds"）

**詳細要件**

- **バックエンド**: `GET /api/devices/{device_type}/details` API で、`MT_elec_characteristic` の全バイアス条件フィールドを取得する
- **フロントエンド**: Detail Drawer コンポーネントで、取得した複数フィールドを組み合わせて表示するロジックを実装
- **表示形式**: 値が存在するフィールドのみを使用し、読みやすい形式で結合する

**タスク**

- [x] バックエンド API の修正（全バイアス条件フィールドの取得）
- [x] フロントエンド Detail Drawer の CONDITION 欄表示ロジック実装
- [x] 空白フィールドのフィルタリング処理
- [x] 表示形式の調整と視認性確認
- [x] 実データでの動作確認

## Issue 11: Detail Drawer へのエクセルエクスポートボタン実装

**概要**
Detail Drawer の左上に、印刷ボタンと閉じるボタンの間にエクセルエクスポートボタンを追加し、表示されている内容を事前に用意したエクセルテンプレートを使用して出力する機能を実装する。

**背景**
現在、Detail Drawer には印刷ボタンと閉じるボタンのみが配置されているが、表示されているデバイス詳細情報をエクセル形式でエクスポートできると、データの二次利用や社内共有が容易になる。エクセルテンプレートを使用することで、統一されたフォーマットでの出力が可能となる。

**詳細要件**

### UI 配置

- Detail Drawer の左上ヘッダー部分に、以下の順序でボタンを配置:
  1. 印刷ボタン（既存）
  2. **エクセルエクスポートボタン（新規）**
  3. 閉じるボタン（既存）

### エクスポート機能

- **エクセルテンプレート**:
  - 事前に定義されたエクセルテンプレートファイルを用意
  - テンプレートには SPEC SHEET のレイアウトを再現（ヘッダー、セクション、テーブルなど）
- **データマッピング**:
  - Detail Drawer で表示されている全データをテンプレートの適切なセルに埋め込む
  - CHIP SPECS、Maximum Ratings、WAFER PROBING SPEC などのセクションごとにマッピング
- **ファイル名**:
  - デバイスタイプとシート番号を含む分かりやすいファイル名（例: `SpecSheet_[device_type]_[sheet_no].xlsx`）
- **ダウンロード**:
  - ボタンクリックで即座にエクセルファイルをダウンロード

### 技術実装

- **バックエンド**:
  - エクセルエクスポート用 API エンドポイントの作成（例: `GET /api/devices/{device_type}/export-excel`）
  - Python ライブラリ（`openpyxl` または `xlsxwriter`）を使用してエクセルファイルを生成
  - テンプレートファイルの読み込みとデータ埋め込み処理
- **フロントエンド**:
  - Detail Drawer コンポーネントにエクセルエクスポートボタンを追加
  - ボタンクリック時に API を呼び出し、生成されたファイルをダウンロード
  - アイコンは Excel を連想させるもの（例: 📊 または表計算アイコン）

**タスク**

- [x] エクセルテンプレートファイルの作成（仮作成完了）
- [x] バックエンドにエクセルエクスポート API の実装
  - [x] `openpyxl` または `xlsxwriter` のインストール
  - [x] テンプレート読み込み処理
  - [x] データマッピングロジック
  - [x] ファイル生成とレスポンス処理
- [x] フロントエンドにエクスポートボタンの追加
  - [x] ボタン UI の実装（印刷ボタンと閉じるボタンの間に配置）
  - [x] API 呼び出し処理
  - [x] ファイルダウンロード処理
- [x] 実データでの動作確認
- [x] **テンプレートの差し替え（ユーザー対応予定）**
  - [x] 正式なテンプレート (`backend/data/templates/specsheet_template.xlsm`) への差し替え完了
  - [x] データ挿入ロジックの修正（行挿入対応）

## Issue 12: Master Tables の横スクロール機能の実装

**概要**
Master Tables の各テーブルメイン表示画面において、横スクロール機能が正常に動作していないため、カラム数が多い横長のテーブル（例: `MT_maskset`）で全データを確認できない問題を解決する。

**背景**
`MT_maskset` などの一部のマスターテーブルは、多数のカラムを持つ横長のテーブル構造となっている。現在の実装では、テーブルが画面幅を超えた場合に横スクロールが機能せず、右側のカラムが表示されない、または確認できない状態となっている。これにより、ユーザーは全データを閲覧することができず、業務に支障をきたしている。

**現状の問題**

- テーブルコンテナに適切な `overflow-x` スタイルが設定されていない
- 横長のテーブル（`MT_maskset` など）で右側のカラムが表示されない
- ユーザーが全データを確認できない

**修正案**

- **テーブルコンテナの修正**:
  - テーブルを囲むコンテナに `overflow-x: auto` または `overflow-x: scroll` を設定
  - 必要に応じて `white-space: nowrap` をテーブルセルに設定し、テキストの折り返しを防ぐ
- **レスポンシブ対応**:
  - 画面サイズに応じて適切にスクロールバーが表示されるようにする
  - モバイル表示でも横スクロールが機能するようにする
- **UI/UX の改善**:
  - スクロールバーの視認性を向上させる（カスタムスタイリング）
  - 横スクロール可能であることをユーザーに示す視覚的なヒント（例: 右端にフェードアウトグラデーション）

**詳細要件**

- **フロントエンド**:
  - DataTable コンポーネントまたはテーブル表示部分の CSS を修正
  - テーブルコンテナに適切な `overflow` プロパティを設定
  - 必要に応じてテーブルの最小幅を設定
- **動作確認**:
  - `MT_maskset` などの横長テーブルで全カラムが確認可能か検証
  - ダークモード/ライトモードの両方で視認性を確認
  - 各種ブラウザ（Chrome, Firefox, Safari など）での動作確認

**タスク**

- [x] 現在のテーブル表示コンポーネントの調査
- [x] テーブルコンテナへの `overflow-x` スタイル追加
- [x] 横長テーブル（`MT_maskset` など）での動作確認
- [x] スクロールバーのスタイリング調整
- [x] レスポンシブ対応の確認
- [x] 各種ブラウザでの動作検証

## Issue 13: ダークモード時のカーソル選択レコードの視認性改善

**概要**
ダークモード時に、テーブルでカーソル選択したレコード（行）の背景色が白色系となり、テキストが判別できない問題を解決する。

**背景**
現在の実装では、ダークモードとライトモードで同じ選択時の背景色スタイルが適用されているため、ダークモード時に選択された行の背景色が白色系になり、白色のテキストと重なって文字列が読めなくなっている。これにより、ユーザーがどのレコードを選択しているのか、またその内容を確認することができず、ユーザビリティが著しく低下している。

**現状の問題**

- ダークモード時、選択レコードの背景色が白色系（ライトモード用の色）になる
- 白色背景に白色テキストが表示され、文字列が判別不可能
- ユーザーが選択したレコードの内容を確認できない

**修正案**

- **ダークモード専用の選択スタイル**:
  - ダークモード時の選択レコード背景色を、テキストが読みやすい色に変更
  - 例: 濃いグレー、濃い青、または半透明の明るい色
  - テキスト色も必要に応じて調整（例: 白 → より明るい白、またはアクセントカラー）
- **ホバー時のスタイル**:
  - ホバー時の背景色もダークモードに対応させる
  - 選択状態とホバー状態の区別が明確になるようにする
- **コントラスト比の確保**:
  - WCAG 2.1 のアクセシビリティガイドラインに準拠したコントラスト比を確保
  - 最低でも 4.5:1 のコントラスト比を目指す

**詳細要件**

- **フロントエンド**:
  - DataTable コンポーネントまたはテーブル行の CSS を修正
  - ダークモード時の選択状態用のスタイルクラスを追加
  - CSS 変数またはテーマ設定を使用してダークモード/ライトモードで異なる色を適用
- **カラースキーム**:
  - ライトモード: 選択時背景色（例: 薄い青 `#e3f2fd`）、テキスト色（例: 黒 `#000000`）
  - ダークモード: 選択時背景色（例: 濃い青 `#1e3a5f` または濃いグレー `#424242`）、テキスト色（例: 白 `#ffffff`）
- **動作確認**:
  - ダークモード/ライトモードの両方で選択レコードの視認性を確認
  - ホバー状態と選択状態の区別が明確か確認
  - 各種ブラウザでの表示確認

**タスク**

- [x] 現在の選択スタイルの調査（CSS クラス、変数の確認）
- [x] ダークモード時の選択背景色とテキスト色の選定
- [x] CSS の修正（ダークモード専用スタイルの追加）
- [x] ホバー時のスタイルも同様に修正
- [x] コントラスト比の検証
- [x] ダークモード/ライトモードでの動作確認
- [x] 各種ブラウザでの表示確認

**結果**

- `frontend/src/index.css` に CSS 変数 `--table-row-hover` を導入し、ライトモードとダークモードで適切なホバー色（背景色）が適用されるように修正しました。
- ダークモード時は `--table-row-hover: #334155` (Slate 700) を使用し、白色テキストとのコントラストを確保しました。
- これにより、ダークモード時でも選択・ホバーしたレコードの内容が明確に読み取れるようになりました。

## Issue 22: Detail Drawer のエクセル出力レイアウト修正

**概要**
Detail Drawer のエクセルエクスポート機能において、テンプレートを使用した出力時に行ずれが発生し、意図したレイアウトにならない問題を解決する。

**背景**
Issue 11 でエクセルエクスポート機能が実装され、テンプレートファイル (`backend/data/templates/specsheet_template.xlsm`) を使用してデータを出力する機能が追加された。しかし、実際の出力結果において、データの行ずれが発生したり、テンプレートで意図したレイアウトが再現されない問題が確認されている。これにより、エクスポートされたエクセルファイルが業務で使用できない状態となっている。

**現状の問題**

- テンプレートを使用したエクスポート時に、データが意図したセル位置に配置されない
- 行ずれが発生し、セクションごとのデータ配置が崩れる
- テンプレートのレイアウト（ヘッダー、セクション、テーブル構造）が正しく再現されない
- データマッピングロジックに不具合がある可能性

**詳細要件**

- **データマッピングの修正**:
  - テンプレートの各セル位置を正確に特定し、データを適切な位置に配置する
  - セクションごと（CHIP SPECS、Maximum Ratings、WAFER PROBING SPEC、NOTES など）のデータ配置を確認・修正
  - 行挿入処理が正しく動作しているか検証
- **テンプレート構造の確認**:
  - テンプレートファイルの構造を詳細に調査
  - データ挿入位置のマーカーや命名規則を確認
  - マージされたセルや結合セルの扱いを適切に処理
- **レイアウトの整合性確保**:
  - テンプレートで定義されたレイアウトが正確に再現されることを確認
  - 各セクションの位置関係が正しく維持される
  - フォント、罫線、セル結合などの書式設定が保持される

**タスク**

- [ ] 現在のエクスポート処理のコードを詳細に調査
- [ ] テンプレートファイルの構造とデータ挿入位置の確認
- [ ] データマッピングロジックの見直しと修正
- [ ] 行挿入処理の動作確認と修正
- [ ] セクションごとのデータ配置の検証
- [ ] 実データでの出力結果の確認と比較
- [ ] テンプレートレイアウトとの整合性確認
- [ ] 各種デバイスタイプでの動作検証
