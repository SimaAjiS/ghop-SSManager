# 要件定義書 (Requirements Definition)

## 1. プロジェクト概要

**プロジェクト名**: Master Table Manager

**目的**:
Excel ファイルで管理されている各種マスタデータを、Web ブラウザ上で容易に閲覧・検索・確認できるようにする。

**主な機能**:

- Excel ファイルからのデータインポート
- マスタテーブル一覧の表示
- 各テーブルデータの詳細表示
- データの検索・ソート機能

## 2. システム構成

### 2.1 技術スタック

- **バックエンド**:
  - 言語: Python 3.13
  - フレームワーク: FastAPI (Entry point: `app.py`)
  - データベース: SQLite (`master.db`)
  - ORM/DB 操作: SQLAlchemy
  - データ処理: Pandas, OpenPyXL
  - パッケージ管理: uv
- **フロントエンド**:
  - フレームワーク: React 19
  - ビルドツール: Vite 7
  - HTTP クライアント: Axios
  - UI コンポーネント/アイコン: Lucide React
  - スタイリング: Vanilla CSS

### 2.2 データフロー

1. 管理者が Excel ファイル (`data/master_tables_dummy.xlsx`) を更新。

- このエクセルファイルはユーザー定義ファイルとして指定しやすくしたい

2. インポートスクリプト (`scripts/import_data.py`) を実行し、Excel データを SQLite データベースに取り込む。
3. ユーザーが Web ブラウザからアクセス。
4. React フロントエンドが FastAPI バックエンドからデータを取得し、画面に表示する。

## 3. 機能要件

### 3.1 データインポート機能

- **入力ソース**: `data/master_tables_dummy.xlsx` (設定ファイル `settings.py` の `MASTER_EXCEL_FILE` で変更可能)
- **処理内容**:
  - Excel ファイルの全シートを読み込む。
  - 各シート名をテーブル名としてデータベースに保存する。
  - 既存のテーブルは削除（DROP）され、再作成（CREATE）される（洗い替え方式）。
  - 各テーブルには自動的に `ID` カラム（主キー、自動採番）が付与される。
  - `ID` という名前のカラムが Excel に存在する場合は、DB 側の自動採番を優先するため除外される。

### 3.2 バックエンド API

- **テーブル一覧取得 API** (`GET /api/tables`)
  - データベース内の全テーブル名をリストとして返す。
  - 定義された順序 (`TABLE_ORDER`) に基づきソートして返却する。定義外のテーブルはアルファベット順となる。
- **テーブルデータ取得 API** (`GET /api/tables/{table_name}`)
  - 指定されたテーブルの全データを JSON 形式で返す。
  - NaN（欠損値）や日付データは適切に処理される。
  - テーブルが存在しない場合は 404 エラーを返す。

### 3.3 フロントエンド (UI/UX)

- **サイドバー (テーブルナビゲーション)**
  - 利用可能なマスタテーブルの一覧を表示する。
  - 選択中のテーブルをハイライト表示する。
- **メインコンテンツ (データ表示エリア)**
  - **ヘッダー**:
    - 現在選択されているテーブル名を表示。
    - **検索ボックス**: 全カラムを対象としたキーワード検索が可能。入力に合わせてリアルタイムにフィルタリングする。
  - **データテーブル**:
    - データをグリッド形式で表示する。
    - **ソート機能**: 各カラムヘッダーをクリックすることで、昇順・降順の並び替えが可能。数値と文字列を適切に判別してソートする。
    - **ローディング表示**: データ取得中に「読み込み中...」を表示する。
    - **エラー表示**: データ取得失敗時にエラーメッセージを表示する。
    - **データなし表示**: データが存在しない、または検索結果が 0 件の場合にメッセージを表示する。

## 4. 非機能要件

- **パフォーマンス**: 数千行程度のマスタデータであれば、ストレスなく表示・検索できること。
- **ユーザビリティ**: シンプルで直感的な UI。検索やソートがスムーズに行えること。
- **保守性**:
  - バックエンドとフロントエンドが疎結合であること。
  - データ構造の変更（Excel 列の追加など）が、コード修正なしで反映されること（動的なスキーマ生成）。

## 5. 運用フロー

1. **データ更新**: Excel ファイルを編集して保存。
2. **反映**: `uv run scripts/import_data.py` を実行して DB を更新。
3. **起動**:
   - Mac/Linux: `run_app.command` を実行、または `uv run uvicorn app:app --reload --port 8000`
   - Windows: `run_app.bat` を実行
4. **利用**: ブラウザをリロードして最新データを閲覧。
